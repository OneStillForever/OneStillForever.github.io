# dot1x

# ip 부여
R2
enconf thostname R2no ip domain lookupline console 0logging syncexec-timeout 0exit
int lo 0ip add 10.0.0.5 255.255.255.2exit
int gi0/0no shutip add 172.16.0.9 255.255.255.252exit
int se0/0/1no shutip add 172.16.0.2 255.255.255.252exit
router ospf 1
router-id 2.2.2.2
network 172.16.0.2 0.0.0.0 area 0
network 172.16.0.9 0.0.0.0 area 0
~~network 10.0.0.5 0.0.0.0 area 0  (~~ 일반적으로 isp 를 ospf에 포함 안시킨다고 함)
default-information originate always
-
ip domain-name R2.com
service password-encryption
crypto key generate rsa      ( -> 1024)
ip ssh version 2username cisco password 0 ciscoline vty 0 4login localtransport input ssh
enable secret cisco
---
enconf thostname L3SW2no ip domain lookupline console 0logging syncexec-timeout 0exit
~~interface fa0/2~~
~~no sw~~
~~no shut~~
~~ip add 172.16.0.41 255.255.255.0~~
int lo 0 
ip add 20.20.20.20 255.255.255.0
interface fa0/1
no sw
no shut
ip address 172.16.0.34 255.255.255.252
interface fa0/6
no sw
no shut
ip address 172.16.0.30 255.255.255.252
vlan 40name Users40
(interface vlan 40ip address 192.168.10.3 255.255.255.0standby 1 ip  192.168.40.1standby 1 priority 115standby 1 preempt)
router ospf 1
router-id 20.20.20.20
network 172.16.0.34 0.0.0.0 area 1
network 172.16.0.30 0.0.0.0 area 1
network  20.20.20.20 0.0.0.0 area 1
(vlan은 아직 안줌
ip domain-name L3SW2.com
service password-encryption
crypto key generate rsa      ( -> 1024)
ip ssh version 2username cisco password 0 ciscoline vty 0 4login localtransport input ssh
enable secret cisco
---
enconf thostname L2SW2no ip domain lookupline console 0logging syncexec-timeout 0exit
ip domain-name L2SW2.com
service password-encryption
crypto key generate rsa      ( -> 1024)
ip ssh version 2username cisco password 0 ciscoline vty 0 4login localtransport input ssh
enable secret cisco
vlan 10name vlan10vlan 999name NATIVE_BLOCK
vlan 1000
name manege_ip
interface Vlan 1000ip address 192.168.100.6 255.255.255.0no shutdown
ip default-gateway `192.168.100.3`exit
interface fa0/1switchport mode trunkswitchport trunk allowed vlan 10
~~switchport trunk native vlan 999~~
switchport trunk allowed vlan add 1000
interface fa0/2switchport mode trunk~~switchport trunk native vlan 999~~
switchport trunk allowed vlan 10
switchport trunk allowed vlan add 1000
int fa0/3switchport mode accessswitchport access vlan 10dot1x pae authenticatorauthentication port-control autospanning-tree portfast
int fa0/4switchport mode accessswitchport access vlan 10
dot1x pae authenticatorauthentication port-control autospanning-tree portfast
authentication open
interface range fa0/5-24shutdownswitchport mode accessswitchport access vlan 999
dot1x system-auth-control
aaa new-modelaaa authentication dot1x default group radiusradius-server host 192.168.50.5 auth-port 1812 acct-port 1813 key cisco
---
track 1 interface FastEthernet0/1 line-protocol!track 2 interface FastEthernet0/6 line-protocol
interface Loopback0ip address 20.20.20.20 255.255.255.0!interface FastEthernet0/1no switchportip address 172.16.0.34 255.255.255.252!interface FastEthernet0/6no switchportip address 172.16.0.30 255.255.255.252!interface Vlan40ip address 192.168.40.3 255.255.255.0standby 1 ip 192.168.40.1standby 1 preempt!interface Vlan50ip address 192.168.50.3 255.255.255.0standby 1 ip 192.168.50.1standby 1 priority 115standby 1 preemptstandby 1 track 1 decrement 10standby 1 track 2 decrement 10
---
1.스위치 접속용 ip를 할당한 vlan을 보통 모든 스위치가 같이 사용하는지
2.관리용 vlan도 hsrp를 통한 경로 이중화를 하는지.
(+3.이중화를 하지 않는 다면 ospf network에서 0.0.0.31로 광고해도 되는지)
| 장비 이름 | 관리 IP 주소 (VLAN 1000) | 해당 스위치에 할당될 L3 인터페이스 (SVI) | 비고 || --- | --- | --- | --- || L3SW1 | `192.168.100.1` | `interface Vlan 1000` | 분배 계층 스위치 1 || L3SW2 | `192.168.100.2` | `interface Vlan 1000` | 분배 계층 스위치 2 || L3SW3 | `192.168.100.3` | `interface Vlan 1000` | 분배 계층 스위치 3 || L3SW4 | `192.168.100.4` | `interface Vlan 1000` | 분배 계층 스위치 4 || L2SW1 | `192.168.100.5` | `interface Vlan 1000` | 액세스 계층 스위치 1 || L2SW2 | `192.168.100.6` | `interface Vlan 1000` | 액세스 계층 스위치 2 || L2SW3 | `192.168.100.7` | `interface Vlan 1000` | 액세스 계층 스위치 3 || L2SW4 | `192.168.100.8` | `interface Vlan 1000` | 액세스 계층 스위치 4 || Switch4 | `192.168.100.9` | `interface Vlan 1000` | 서버 연결 스위치 |
### L2 스위치 관리형 IP 설정
!1. 관리용 VLAN 생성 및 이름 지정vlan 1000name MANAGEMENT_VLAN exit
2. 관리용 VLAN 인터페이스 (SVI)에 IP 주소 할당!    (이것이 스위치의 관리 IP가 됩니다)interface Vlan 1000ip address 192.168.100.10 255.255.255.0no shutdownexit
3. L2 스위치의 기본 게이트웨이 설정!    (관리 IP 네트워크가 아닌 다른 네트워크로 통신할 때 필요합니다.!     예: RADIUS 서버가 다른 네트워크에 있거나, 관리 PC가 다른 네트워크에 있을 때)
ip default-gateway 192.168.100.254  // 관리 VLAN의 L3 스위치 게이트웨이 IP
4. 관리용 VLAN 트래픽이 통과할 수 있도록 업링크 포트 설정 (매우 중요!)!    (L2SW2에서 L3SW3으로 연결되는 물리 포트)interface [L3SW3으로 연결된 물리 포트 예: GigabitEthernet0/1]switchport mode trunkswitchport trunk allowed vlan add 1000  // 관리 VLAN 트래픽 허용exit
~~5. (선택 사항) 관리용 PC를 L2SW에 직접 연결하는 경우 해당 포트 설정!    (대부분은 업링크를 통해 관리)Switch(config)# interface [관리용 PC가 연결될 물리 포트 예: FastEthernet0/10]Switch(config-if)# switchport mode accessSwitch(config-if)# switchport access vlan 1000Switch(config-if)# exit~~
6. 설정 저장Switch(config)# endSwitch# copy running-config startup-config
dot1x system-auth-control
## aaa new-modelaaa authentication dot1x default group radius
### radius-server host 서버ip auth-port 1812 acct-port 1813 cisco (radius 서버 ip 주소 50.5 )****
int range fa0/3-4 (laptop과 연결된 (access)포트만,  trunk (x))switchport mode accessdot1x pae authenticatorauthentication port-control autospanning-tree portfastexit~~int range fa0/1-4~~
- `~~authentication open~~`    - **명령어 역할:**        - 이 명령어는 **802.1X 인증에 실패하거나, 클라이언트(장치)가 802.1X 인증을**        - **지원하지 않을 경우에도 해당 포트가 트래픽을 허용하도록 설정**합니다.        - 즉, 802.1X 인증이 성공하지 못해도 포트를 "열어주는(Open)" 예외적인 상황을 처리할 때 사용합니다. 일종의 '인증 실패 시 대체 정책'이라고 볼 수 있습니다.                → 일반적으로 랩톱과 같은 최종 사용자 장치에 802.1X 인증을 적용할 때, 인증에 실패하면 트래픽을 허용하지 않는 것이 보안의 기본 목적 (→ laptop에서는 authentication open 해주면 안됨)                - L2SW1 하나에 설정하면 다른 Access switch에서 설정 안해줘도 되나?                ![image.png](attachment:1379aa0f-41cf-4a6d-98cf-49a151f541ce:image.png)                **그렇게는 못합니다:** 802.1X는 포트 기반 인증이므로, 네트워크 전체의 특정 서버 접근을 제어하는 용도로는 적합하지 않습니다.        
- show dot1x all        ![image.png](attachment:1ed685d5-1890-456b-bb8b-0fd9ee4a7b55:image.png)    
user Cleartext-Password := "user"MS-CHAP-Use-NTLM-Auth := No,Service-Type = NAS-Prompt-User,Cisco-AVPair = "shell:priv-lvl=15"
- 설정 의미    - `user`라는 **새로운 사용자 계정**을 정의하고 있습니다.    - 비밀번호는 "user"이며, 평문(Cleartext)으로 저장됩니다.    - `MS-CHAP-Use-NTLM-Auth := No`는 MS-CHAP 인증 시 NTLM 인증 방식을 사용하지 않도록 하는 설정입니다.    - `Service-Type = NAS-Prompt-User`와 `Cisco-AVPair = "shell:priv-lvl=15"`는 인증 후 사용자에게 어떤 권한을 줄 것인지에 대한 **인가(Authorization) 속성**입니다. `NAS-Prompt-User`는 주로 콘솔/텔넷 로그인 시 사용되며, `priv-lvl=15`는 Cisco 장비에서 최고 관리자 권한을 부여
![image.png](attachment:95dd41e9-b4ae-41c1-be3a-6ae3b21f6263:image.png)
인증이 없음
![image.png](attachment:beee9bbd-b1ab-4e14-8fe8-13925c3a6351:image.png)
윈도우+R
![image.png](attachment:72995ef6-c254-4c4c-a875-af080ce0ffdf:image.png)
![image.png](attachment:88621c44-fbc4-45d8-a9e4-16c88fa7c748:image.png)
→
![image.png](attachment:11143a71-daf1-4a58-b385-6726f83cb1b6:image.png)
인증 생김
![image.png](attachment:99ed5ac4-8fcb-4114-8515-924d49bf8363:image.png)
192.168.50.5(서버 주소)
![image.png](attachment:7937ee66-af37-4c04-9791-67fcd8d56da8:image.png)
---
### 오류
+병철님 linux에서 switch ip주소 빠져 있었음
![image.png](attachment:cc46dd72-b45e-42da-ac65-17dc295986ba:image.png)
- **해석:** `Fa0/3` 인터페이스에서 **보안 위반이 즉시 다시 발생했습니다.** 이전 인증을 성공한 MAC 주소(`2c58.b9ef.174d`)와는 **다른 새로운 MAC 주소(`000c.29a6.5155`)가 감지**되었습니다.
![image.png](attachment:df3d77c0-a2e0-4f6f-a081-157be40f81bc:image.png)
cml이 켜졌있었고, cml의 bridged 의 mac주소가 포트로 연결이 감지되어 down 된거 였음